// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Business {
  id        String   @id @default(cuid())
  name      String
  email     String?
  phone     String?
  address   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users     User[]
  clients   Client[]
  services  Service[]
  bookings  Booking[]
  invoices  Invoice[]
  contacts  Contact[]

  @@map("businesses")
}

model User {
  id         String   @id @default(cuid())
  email      String   @unique
  password   String
  name       String?
  role       String   @default("owner") // owner, staff
  businessId String
  business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("users")
}

model Client {
  id         String    @id @default(cuid())
  name       String
  email      String?
  phone      String?
  address    String?
  businessId String
  business   Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)
  bookings   Booking[]
  invoices   Invoice[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@map("clients")
}

model Service {
  id           String        @id @default(cuid())
  name         String
  description  String?
  price        Decimal
  duration     Int // minutes
  businessId   String
  business     Business      @relation(fields: [businessId], references: [id], onDelete: Cascade)
  bookings     Booking[]
  invoiceItems InvoiceItem[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("services")
}

model Booking {
  id          String   @id @default(cuid())
  clientId    String
  client      Client   @relation(fields: [clientId], references: [id], onDelete: Restrict)
  serviceId   String
  service     Service  @relation(fields: [serviceId], references: [id], onDelete: Restrict)
  businessId  String
  business    Business @relation(fields: [businessId], references: [id], onDelete: Cascade)
  scheduledAt DateTime
  status      String   @default("scheduled") // scheduled, completed, cancelled
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("bookings")
}

model Invoice {
  id            String        @id @default(cuid())
  invoiceNumber String        @unique
  clientId      String
  client        Client        @relation(fields: [clientId], references: [id], onDelete: Restrict)
  businessId    String
  business      Business      @relation(fields: [businessId], references: [id], onDelete: Cascade)
  items         InvoiceItem[]
  total         Decimal
  status        String        @default("unpaid") // paid, unpaid
  issuedAt      DateTime      @default(now())
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("invoices")
}

model InvoiceItem {
  id        String   @id @default(cuid())
  invoiceId String
  invoice   Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  serviceId String
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Restrict)
  quantity  Int      @default(1)
  price     Decimal
  total     Decimal
  createdAt DateTime @default(now())

  @@map("invoice_items")
}

model Contact {
  id         String    @id @default(cuid())
  name       String
  email      String
  message    String
  businessId String?
  business   Business? @relation(fields: [businessId], references: [id], onDelete: SetNull)
  createdAt  DateTime  @default(now())

  @@map("contacts")
}
